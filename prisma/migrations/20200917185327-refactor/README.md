# Migration `20200917185327-refactor`

This migration has been generated by svirins at 9/17/2020, 9:53:27 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."AuthTypeEnum" AS ENUM ('Email', 'Facebook', 'Google', 'Apple')

DROP INDEX "public"."Image_EventId_unique"

DROP INDEX "public"."Location_EventId_unique"

DROP INDEX "public"."Location_GroupId_unique"

ALTER TABLE "public"."Contact" DROP CONSTRAINT "Contact_EventId_fkey"

ALTER TABLE "public"."Image" DROP CONSTRAINT "Image_EventId_fkey"

ALTER TABLE "public"."Location" DROP CONSTRAINT "Location_EventId_fkey"

ALTER TABLE "public"."Location" DROP CONSTRAINT "Location_GroupId_fkey"

ALTER TABLE "public"."Contact" DROP COLUMN "EventId",
ADD COLUMN "eventId" integer   NOT NULL 

ALTER TABLE "public"."Image" DROP COLUMN "EventId",
ADD COLUMN "eventId" integer   NOT NULL 

ALTER TABLE "public"."Location" DROP COLUMN "GroupId",
DROP COLUMN "EventId",
ADD COLUMN "groupId" integer   NOT NULL ,
ADD COLUMN "eventId" integer   NOT NULL 

ALTER TABLE "public"."Meeting" DROP COLUMN "model",
ADD COLUMN "type" "MeetingEnum"  NOT NULL 

CREATE TABLE "public"."Profile" (
"id" SERIAL,
"socialId" text   NOT NULL ,
"authType" "AuthTypeEnum"  NOT NULL ,
"verified" boolean   NOT NULL ,
"userId" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "Profile.userId_unique" ON "public"."Profile"("userId")

CREATE UNIQUE INDEX "Image_eventId_unique" ON "public"."Image"("eventId")

CREATE UNIQUE INDEX "Location_groupId_unique" ON "public"."Location"("groupId")

CREATE UNIQUE INDEX "Location_eventId_unique" ON "public"."Location"("eventId")

ALTER TABLE "public"."Profile" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Contact" ADD FOREIGN KEY ("eventId")REFERENCES "public"."Event"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Image" ADD FOREIGN KEY ("eventId")REFERENCES "public"."Event"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Location" ADD FOREIGN KEY ("groupId")REFERENCES "public"."Group"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Location" ADD FOREIGN KEY ("eventId")REFERENCES "public"."Event"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200915155009-init..20200917185327-refactor
--- datamodel.dml
+++ datamodel.dml
@@ -1,22 +1,33 @@
+
 generator client {
-  provider = "prisma-client-js"
+  provider = "prisma-client-ts"
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model User {
   id           Int             @id @default(autoincrement())
   name         String          @unique
   email        String          @unique
   password     String          @unique 
   groups       Group[]         
-  events       Event[]         
+  events       Event[]     
+  profile      Profile    
 }
+model Profile {
+  id          Int         @id @default(autoincrement()) 
+  socialId    String
+  authType    AuthTypeEnum
+  verified    Boolean
+  user        User        @relation(fields: [userId], references: [id])
+  userId      Int         @unique
+}
+
 model Group {
   id               Int          @id @default(autoincrement()) 
   createdAt        DateTime     @default(now())
   birthday         DateTime     
@@ -41,9 +52,9 @@
   groupId          Int 
   name             String       @default("New AA Meeting")
   weekday          WeekdayEnum
   time             DateTime 
-  model            MeetingEnum  @default(Closed)
+  type             MeetingEnum  
 } 
 model Event {
   id               Int         @id @default(autoincrement()) 
@@ -63,28 +74,28 @@
 }
 model Location {
   id               Int          @id @default(autoincrement()) 
-  GroupRel         Group        @relation(fields: [GroupId], references: [id])
-  GroupId          Int
-  EventRel         Event        @relation(fields: [EventId], references: [id])
-  EventId          Int
+  groupRel         Group        @relation(fields: [groupId], references: [id])
+  groupId          Int
+  eventRel         Event        @relation(fields: [eventId], references: [id])
+  eventId          Int
   lattitude        Float
   longitude        Float
 }  
 model Image {
   id               Int          @id @default(autoincrement())
-  EventRel         Event        @relation(fields: [EventId], references: [id])
-  EventId          Int
+  eventRel         Event        @relation(fields: [eventId], references: [id])
+  eventId          Int
   publicId         String      
   cloudinaryUrl    String       
 }
 model Contact {
   id               Int          @id @default(autoincrement()) 
-  EventRel         Event        @relation(fields: [EventId], references: [id])
-  EventId          Int
+  eventRel         Event        @relation(fields: [eventId], references: [id])
+  eventId          Int
   name             String
   phone            String
   responsibility   String       @default("Координатор")
 }
@@ -115,4 +126,11 @@
   Mogilevskaya
   Grodnenskaya
   Vitebskaya
 }
+
+enum AuthTypeEnum {
+  Email
+  Facebook
+  Google
+  Apple
+}
```


